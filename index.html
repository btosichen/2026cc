<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‘—ä½œæ¬Šå†’éšªå³¶ - é—–é—œå¤§æŒ‘æˆ°</title>
    <style>
        :root {
            --primary: #ff7eb9; /* ç²‰ç´… */
            --secondary: #70d6ff; /* å¤©è— */
            --success: #60d394; /* å«©ç¶  */
            --warning: #ffd97d; /* é®®é»ƒ */
            --danger: #ee6055; /* çŠç‘šç´… */
            --bg: #fff9fb;
            --text: #4a4e69;
        }

        body {
            font-family: "Microsoft JhengHei", "Rounded Mplus 1c", sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
            overflow-x: hidden;
        }

        .container { max-width: 800px; margin: 0 auto; padding: 20px; position: relative; }
        
        .card {
            background: #ffffff;
            border: 4px solid #f0f0f0;
            border-radius: 25px;
            box-shadow: 8px 8px 0px #ffd97d;
            padding: 30px;
            margin-bottom: 30px;
            transition: transform 0.2s;
        }

        .header {
            background: var(--primary);
            background: linear-gradient(135deg, #ff7eb9 0%, #ff758c 100%);
            color: white;
            padding: 1.5rem 0;
            text-align: center;
            border-bottom: 6px solid #ff4d91;
            margin-bottom: 20px;
        }

        h1 { margin: 0; font-size: 2rem; text-shadow: 2px 2px 0px rgba(0,0,0,0.1); }

        /* å½±ç‰‡å®¹å™¨ */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            overflow: hidden;
            border-radius: 20px;
            border: 4px solid var(--secondary);
            margin-bottom: 20px;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            background: #fff;
            border: 3px solid #eee;
            border-radius: 50px;
            padding: 8px;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            border-radius: 40px;
            color: #ccc;
            font-size: 0.8rem;
        }
        .step.active { background: var(--secondary); color: white; box-shadow: 0 4px 0 #4da3ff; }

        .btn {
            cursor: pointer;
            border: none;
            border-radius: 50px;
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: 900;
            transition: all 0.2s;
            display: inline-block;
            box-shadow: 0 5px 0 rgba(0,0,0,0.1);
            text-decoration: none;
            text-align: center;
        }
        .btn-primary { background: var(--primary); color: white; width: 100%; margin-top: 10px; box-sizing: border-box; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 0 #ff4d91; }
        .btn-outline { 
            background: white; 
            color: var(--secondary); 
            border: 3px solid var(--secondary); 
            width: 100%; 
            margin-top: 15px;
            font-size: 0.9rem;
            box-sizing: border-box;
        }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        .tf-area { display: flex; justify-content: space-around; margin: 30px 0; }
        .tf-btn { 
            width: 80px; height: 80px; font-size: 40px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            border: 5px solid rgba(0,0,0,0.05);
        }

        .p-item {
            border: 3px solid #f0f0f0;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            background: #fafafa;
            transition: 0.3s;
            font-weight: bold;
        }
        .p-item.selected { border-color: var(--secondary); background: #e0f7ff; box-shadow: 4px 4px 0px var(--secondary); }

        .cc-img { height: 40px; margin-right: 15px; }
        .match-row {
            display: flex; align-items: center; margin-bottom: 12px;
            background: #fff9fb; padding: 10px; border-radius: 15px;
            border: 2px dashed var(--primary);
        }
        select { padding: 8px; border-radius: 10px; border: 2px solid #ddd; flex-grow: 1; font-size: 0.9rem; }

        .timer { font-size: 28px; font-weight: 900; color: var(--danger); }
        .hidden { display: none; }
        #user-info-bar { font-size: 1rem; margin-top: 10px; font-weight: bold; }

        input[type="text"], input[type="number"], select {
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px;
            border: 3px solid #eee; box-sizing: border-box;
        }

        footer { text-align: center; padding: 30px; color: #aaa; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ¨ è‘—ä½œæ¬Šå¤§å†’éšª</h1>
    <div id="user-info-bar" class="hidden">
        ğŸŒŸ <span id="display-name">æ¢éšªå®¶</span> | ğŸ’° ç©åˆ†: <span id="current-score">0</span>
    </div>
</div>

<div class="container">
    <!-- 0. ç™»å…¥èˆ‡é¦–é æ•™å­¸ -->
    <div id="screen-login" class="card">
        <h3 style="text-align: center; color: var(--secondary); margin-top: 0;">ğŸ¬ å…ˆçœ‹å½±ç‰‡è¤‡ç¿’ä¸€ä¸‹å§ï¼</h3>
        <div class="video-container">
            <iframe src="https://www.youtube.com/embed/9fuajCuCV4g" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
        </div>

        <div style="border-top: 2px dashed #eee; padding-top: 20px;">
            <h3 style="text-align: center; color: var(--primary);">æº–å‚™å¥½å°±é–‹å§‹é—–é—œï¼</h3>
            <label>ğŸŒˆ ä½ çš„ç­ç´š</label>
            <select id="input-class">
                <option value="701">701 ç­</option><option value="702">702 ç­</option>
                <option value="703">703 ç­</option><option value="704">704 ç­</option>
                <option value="705">705 ç­</option>
            </select>
            <label>ğŸ”¢ ä½ çš„åº§è™Ÿ</label>
            <input type="number" id="input-seat" placeholder="ä¾‹å¦‚ï¼š05">
            <label>ğŸ‘¤ è‹±é›„å§“å</label>
            <input type="text" id="input-name" placeholder="è¼¸å…¥ä½ çš„åå­—">
            <button class="btn btn-primary" onclick="startGame()">é–‹å§‹å†’éšªï¼</button>
            
            <a href="https://docs.google.com/spreadsheets/d/1l-9wEmIvy17y7eSRwBloJgAw9JocV74eKiItzcPm9Hw/edit?usp=sharing" target="_blank" class="btn btn-outline">ğŸ“Š æŸ¥çœ‹å…¨ç­ä½œç­”ç´€éŒ„</a>
        </div>
    </div>

    <!-- é€²åº¦æ¢ -->
    <div id="game-progress" class="progress-container hidden">
        <div class="step" id="step-1">å¿«å•å¿«ç­”</div>
        <div class="step" id="step-2">å››å¤§åŸå‰‡</div>
        <div class="step" id="step-3">CC é…å°</div>
        <div class="step" id="step-4">AI çˆ­è­°</div>
    </div>

    <!-- Level 1: æ˜¯éå¿«å•å¿«ç­” -->
    <div id="level-1" class="card hidden">
        <div style="text-align: right;"><span class="timer" id="l1-timer">60</span> ç§’</div>
        <h3 id="l1-q-text" style="min-height: 80px;">è¼‰å…¥é¡Œç›®ä¸­...</h3>
        <p style="color: var(--secondary); font-weight: bold;">é€²åº¦ï¼š<span id="l1-q-index">1</span>/10</p>
        <div class="tf-area">
            <button class="btn btn-success tf-btn" onclick="checkL1(true)">â­•</button>
            <button class="btn btn-danger tf-btn" onclick="checkL1(false)">âŒ</button>
        </div>
        <p id="l1-feedback" style="text-align:center; font-size: 1.2rem; height: 30px; font-weight: bold;"></p>
    </div>

    <!-- Level 2: å››å¤§åŸå‰‡åˆ¤æ–· -->
    <div id="level-2" class="card hidden">
        <h3 style="color: var(--primary);">ğŸ“ Level 2ï¼šåˆç†ä½¿ç”¨å››å¤§åŸå‰‡</h3>
        <div style="background: #fff9e6; padding: 15px; border-radius: 15px; border-left: 6px solid var(--warning); margin-bottom: 20px;">
            <strong>æƒ…å¢ƒæ¨¡æ“¬ï¼š</strong><br>
            è€å¸«ç‚ºäº†ä¸Šèª²è¨è«–ï¼Œå½±å°äº†æŸç†±é–€å°èªªçš„ã€Œå…¶ä¸­ä¸€å°ç« ç¯€ã€çµ¦å…¨ç­åŒå­¸ç•¶æ•™æã€‚
        </div>
        <p>è«‹é»é¸ç¬¦åˆæœ¬æƒ…å¢ƒçš„æ­£ç¢ºæè¿°ï¼ˆå¤šé¸ï¼‰ï¼š</p>
        <div id="p-box">
            <div class="p-item" onclick="toggleP(this, 1)">â‘  ä½¿ç”¨ç›®çš„ï¼šå±¬æ–¼éç‡Ÿåˆ©æ•™è‚²ç›®çš„</div>
            <div class="p-item" onclick="toggleP(this, 2)">â‘¡ è‘—ä½œæ€§è³ªï¼šå·²ç™¼è¡¨çš„å‰µä½œæ€§è‘—ä½œ</div>
            <div class="p-item" onclick="toggleP(this, 3)">â‘¢ ä½¿ç”¨åˆ†é‡ï¼šåƒ…ä½”åŸè‘—ä½œæ¥µå°æ¯”ä¾‹</div>
            <div class="p-item" onclick="toggleP(this, 4)">â‘£ å¸‚å ´å½±éŸ¿ï¼šä¸è‡³æ–¼å–ä»£åŸæ›¸éŠ·å”®å¸‚å ´</div>
        </div>
        <button class="btn btn-primary" onclick="checkL2()">ç¢ºèªåˆ¤å®šä¸¦å‰é€² â”</button>
    </div>

    <!-- Level 3: CC æˆæ¬Šé…å° -->
    <div id="level-3" class="card hidden">
        <h3 style="color: var(--primary);">ğŸ§© Level 3ï¼šæ¨™èªŒèˆ‡åç¨±é€£é€£çœ‹</h3>
        <p style="font-size: 0.9rem; color: #888;">æ³¨æ„ï¼šé¡Œç›®é †åºæ¯æ¬¡éƒ½æœƒè®Šå–”ï¼</p>
        <div id="cc-match-area">
            <!-- ç”± JS æ‰“äº‚é †åºè¼‰å…¥ -->
        </div>
        <button class="btn btn-primary" onclick="checkL3()">æ ¸å°ç­”æ¡ˆ â”</button>
    </div>

    <!-- Level 4: AI é¢¨æ ¼çˆ­è­° -->
    <div id="level-4" class="card hidden">
        <h3 style="color: var(--primary);">ğŸ¤– Level 4ï¼šAI å‰µæ„çˆ­è­°</h3>
        <p><strong>æ¡ˆä¾‹ï¼š</strong>å°æ˜å« AI æ¨¡ä»¿ã€ŒæŸçŸ¥åç•«å®¶ã€çš„é¢¨æ ¼ç•«äº†ä¸€å †åœ–ï¼Œå°æˆæ˜ä¿¡ç‰‡è³£éŒ¢ã€‚è«‹å•é€™ç®—ä»€éº¼ï¼Ÿ</p>
        <button class="btn btn-primary" style="background:#8ecae6; margin-bottom:10px;" onclick="checkL4(1)">A. åˆç†ï¼šç•«é¢¨æ³•å¾‹ä¸ä¿è­·</button>
        <button class="btn btn-primary" style="background:#219ebc; margin-bottom:10px;" onclick="checkL4(2)">B. ä¾µæ¬Šï¼šå®Œå…¨æŠ„è¥²ç•«å®¶çš„éˆé­‚</button>
        <button class="btn btn-primary" style="background:#023047;" onclick="checkL4(3)">C. éœ€è¦–æƒ…æ³ï¼šç•«é¢¨é›–ä¸ä¿è­·ï¼Œä½†æ§‹åœ–è‹¥å¤ªåƒä»æœ‰ä¾µæ¬Šé¢¨éšª</button>
    </div>

    <!-- çµç®—ç•«é¢ -->
    <div id="screen-result" class="card hidden" style="text-align: center;">
        <h2 style="color: var(--primary);">ğŸ‰ æŒ‘æˆ°æˆåŠŸï¼</h2>
        <p>æ­å–œæ¢éšªå®¶å®Œæˆæ‰€æœ‰è€ƒé©—ï¼</p>
        <div id="final-score-display" style="font-size: 80px; font-weight: 900; color: var(--warning); text-shadow: 4px 4px 0px #ff7eb9;">0</div>
        <div id="sync-status" style="margin: 20px 0; font-weight: bold; color: var(--secondary);">æ­£åœ¨å°‡æˆç¸¾å‚³å›ç¸½éƒ¨...</div>
        <button class="btn btn-primary" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
    </div>
</div>

<footer>
    åƒè€ƒè³‡æ–™ä¾†æºï¼š<a href="https://tw.creativecommons.net/home-page/" target="_blank" style="color:var(--primary);">å°ç£å‰µç”¨ CC è³‡è¨Šç¶²</a>
</footer>
    <footer>
    é™³æ”¿å·è€å¸«è¨­è¨ˆ
</footer>

<script>
    // --- åŠ å¯†ç­”æ¡ˆèˆ‡è¨­å®š ---
    const _E_ANS = {
        l1: ["dHJ1ZQ==", "ZmFsc2U=", "dHJ1ZQ==", "dHJ1ZQ==", "dHJ1ZQ==", "ZmFsc2U=", "dHJ1ZQ==", "ZmFsc2U=", "ZmFsc2U=", "dHJ1ZQ=="],
        cc: { "BY": "Qlk=", "NC": "TkM=", "ND": "TkQ=", "SA": "U0E=" }
    };

    const GAS_URL = "https://script.google.com/macros/s/AKfycbzX-9l7xgkpEmadhoKOnwSRh-VC6vTUhu4ZquIOuuIE2qQgWzt1-Vchp2LraiVVLpQV/exec";
    
    let score = 0;
    let user = {};
    let l1Index = 0;
    let l1Timer = 60;
    let timerId = null;
    let startTime = null;

    const l1Questions = [
        "è‘—ä½œæ¬Šæ˜¯å¾ä½œå“å®Œæˆçš„é‚£ä¸€åˆ»èµ·å°±è‡ªå‹•ç”¢ç”Ÿçš„ã€‚",
        "åªè¦æœ‰è¨»æ˜å‡ºè™•ï¼Œå°±å¯ä»¥éš¨æ„ä¸‹è¼‰æ•´éƒ¨é›»å½±åˆ†é€çµ¦æœ‹å‹ã€‚",
        "åˆç†ä½¿ç”¨å¿…é ˆæ ¹æ“šä½¿ç”¨ç›®çš„ã€æ€§è³ªã€åˆ†é‡åŠå¸‚å ´å½±éŸ¿ä¾†åˆ¤æ–·ã€‚",
        "å‰µç”¨CCçš„ã€ŒNDã€åœ–ç¤ºä»£è¡¨ç¦æ­¢æ”¹ä½œã€‚",
        "æ”¿åºœå…¬æ–‡èˆ‡æ³•å¾‹æ¢æ–‡æ˜¯ä¸å—è‘—ä½œæ¬Šä¿è­·çš„ã€‚",
        "åªè¦æ˜¯ç‚ºäº†å¯«å­¸æ ¡ä½œæ¥­ï¼Œæˆ‘å¯ä»¥æŠŠæ•´æœ¬èª²æœ¬å½±å°ä¸‹ä¾†ã€‚",
        "å‰µç”¨CCä¸­çš„ã€ŒSAã€åœ–ç¤ºä»£è¡¨å¿…é ˆä»¥ç›¸åŒæ–¹å¼åˆ†äº«ã€‚",
        "å¼•ç”¨ä»–äººæ–‡ç« åªè¦ä¸è¶…é 10 å€‹å­—å°±ä¸ç®—ä¾µæ¬Šã€‚",
        "å…¬é–‹æ’­æ”¾è²·ä¾†çš„æ­£ç‰ˆ DVD çµ¦å…¨æ ¡çœ‹æ˜¯ä¸éœ€è¦é¡å¤–æˆæ¬Šçš„ã€‚",
        "å°‡åˆ¥äººçš„è©©éŒ„éŸ³æˆ Podcast ä¸¦å…¬é–‹æ’­æ”¾ï¼Œéœ€è¦å–å¾—æˆæ¬Šã€‚"
    ];

    function startGame() {
        const cls = document.getElementById('input-class').value;
        const seat = document.getElementById('input-seat').value;
        const name = document.getElementById('input-name').value;
        if(!seat || !name) return alert("è¦è¼¸å…¥åå­—è·Ÿåº§è™Ÿæ‰èƒ½é–‹å§‹å†’éšªå–”ï¼âœ¨");
        user = { cls, seat, name };
        startTime = Date.now();
        document.getElementById('display-name').innerText = name;
        showScreen('level-1');
        document.getElementById('user-info-bar').classList.remove('hidden');
        document.getElementById('game-progress').classList.remove('hidden');
        initCCLevel();
        startL1();
    }

    function showScreen(id) {
        ['screen-login', 'level-1', 'level-2', 'level-3', 'level-4', 'screen-result'].forEach(s => {
            document.getElementById(s).classList.add('hidden');
        });
        document.getElementById(id).classList.remove('hidden');
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        if(id.startsWith('level')) {
            document.getElementById(`step-${id.split('-')[1]}`).classList.add('active');
        }
    }

    function startL1() {
        updateL1Question();
        timerId = setInterval(() => {
            l1Timer--;
            document.getElementById('l1-timer').innerText = l1Timer;
            if(l1Timer <= 0) {
                clearInterval(timerId);
                alert("æ™‚é–“åˆ°å›‰ï¼æº–å‚™é€²å…¥ä¸‹ä¸€é—œï¼");
                showScreen('level-2');
            }
        }, 1000);
    }

    function updateL1Question() {
        if(l1Index >= l1Questions.length) {
            clearInterval(timerId);
            setTimeout(() => showScreen('level-2'), 800);
            return;
        }
        document.getElementById('l1-q-text').innerText = l1Questions[l1Index];
        document.getElementById('l1-q-index').innerText = (l1Index + 1);
    }

    function checkL1(userAns) {
        const correct = (window.atob(_E_ANS.l1[l1Index]) === "true");
        const feedback = document.getElementById('l1-feedback');
        if(userAns === correct) {
            score += 5;
            feedback.innerText = "ğŸŒŸ ç­”å°äº†ï¼";
            feedback.style.color = "var(--success)";
        } else {
            feedback.innerText = "ğŸ˜µ ç­”éŒ¯å›‰ï¼";
            feedback.style.color = "var(--danger)";
        }
        document.getElementById('current-score').innerText = score;
        l1Index++;
        setTimeout(() => { feedback.innerText = ""; updateL1Question(); }, 600);
    }

    let selectedP = [];
    function toggleP(el, num) {
        el.classList.toggle('selected');
        if(el.classList.contains('selected')) selectedP.push(num);
        else selectedP = selectedP.filter(n => n !== num);
    }
    function checkL2() {
        if(selectedP.length >= 3) score += 20;
        else score += 10;
        document.getElementById('current-score').innerText = score;
        showScreen('level-3');
    }

    // --- Level 3: æ‰“äº‚é †åºçš„ CC é…å° ---
    function initCCLevel() {
        const ccData = [
            { img: "by.png", tag: "BY", n: "å§“åæ¨™ç¤º" },
            { img: "by-nc.png", tag: "NC", n: "å§“åæ¨™ç¤º-éå•†æ¥­æ€§" },
            { img: "by-nd.png", tag: "ND", n: "å§“åæ¨™ç¤º-ç¦æ­¢æ”¹ä½œ" },
            { img: "by-sa.png", tag: "SA", n: "å§“åæ¨™ç¤º-ç›¸åŒæ–¹å¼åˆ†äº«" }
        ];
        // æ´—ç‰Œæ¼”ç®—æ³•æ‰“äº‚é †åº
        const shuffled = ccData.sort(() => Math.random() - 0.5);
        
        const area = document.getElementById('cc-match-area');
        area.innerHTML = shuffled.map((d) => `
            <div class="match-row">
                <img src="https://tw.creativecommons.net/wp-content/uploads/sites/20/2020/11/${d.img}" class="cc-img">
                <select class="cc-sel" data-tag="${d.tag}">
                    <option value="">è«‹é¸æ“‡å°æ‡‰åç¨±...</option>
                    <option value="BY">å§“åæ¨™ç¤º</option>
                    <option value="NC">å§“åæ¨™ç¤º-éå•†æ¥­æ€§</option>
                    <option value="ND">å§“åæ¨™ç¤º-ç¦æ­¢æ”¹ä½œ</option>
                    <option value="SA">å§“åæ¨™ç¤º-ç›¸åŒæ–¹å¼åˆ†äº«</option>
                </select>
            </div>
        `).join('');
    }

    function checkL3() {
        let correctCount = 0;
        document.querySelectorAll('.cc-sel').forEach(sel => {
            const correctTag = sel.dataset.tag; // åœ–ç‰‡åŸæœ¬çš„ Tag
            if(sel.value === correctTag) correctCount++;
        });
        score += (correctCount * 5);
        document.getElementById('current-score').innerText = score;
        showScreen('level-4');
    }

    function checkL4(choice) {
        if(choice === 3) score += 10;
        else score += 5;
        document.getElementById('current-score').innerText = score;
        finishGame();
    }

    function finishGame() {
        showScreen('screen-result');
        document.getElementById('final-score-display').innerText = score;
        syncToGAS();
    }

    function syncToGAS() {
        const status = document.getElementById('sync-status');
        const duration = Math.floor((Date.now() - startTime) / 1000);
        let rank = score >= 90 ? "S" : (score >= 80 ? "A" : (score >= 60 ? "B" : "C"));

        const data = { 
            class: user.cls, number: user.seat, name: user.name, 
            score: score, time: duration, rank: rank 
        };
        
        const queryParams = new URLSearchParams(data).toString();
        fetch(`${GAS_URL}?${queryParams}`, { mode: 'no-cors' })
            .then(() => { status.innerText = "âœ… æˆç¸¾å·²å‚³é€åˆ°é›²ç«¯ç´€éŒ„è¡¨ï¼"; })
            .catch(() => { status.innerText = "âŒ å‚³é€å¤±æ•—ï¼Œè«‹æ‹ç…§åˆ†æ•¸ç•«é¢ã€‚"; });
    }
</script>
</body>
</html>
