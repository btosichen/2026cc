<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>著作權合理使用 - 闖關大冒險</title>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #16a34a;
            --warning: #f59e0b;
            --danger: #dc2626;
            --bg: #f0f4f8;
            --card: #ffffff;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: #1e293b;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        
        .card {
            background: var(--card);
            border-radius: 16px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 25px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), #1d4ed8);
            color: white;
            padding: 1.5rem 0;
            text-align: center;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        /* 遊戲進度條 */
        .progress-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            background: #e2e8f0;
            border-radius: 10px;
            padding: 5px;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            border-radius: 8px;
            color: #94a3b8;
        }
        .step.active { background: var(--primary); color: white; }

        /* 按鈕樣式 */
        .btn {
            cursor: pointer;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
            display: inline-block;
        }
        .btn-primary { background: var(--primary); color: white; width: 100%; }
        .btn-next { background: var(--success); color: white; margin-top: 20px; }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; }

        /* Level 1: 是非題 */
        .tf-btn { width: 120px; height: 120px; font-size: 40px; margin: 10px; border-radius: 50%; }

        /* Level 2: 四大原則 */
        .principle-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        .p-item {
            border: 2px solid #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
        }
        .p-item.selected { border-color: var(--primary); background: #eff6ff; }

        /* Level 3: CC 配對 */
        .cc-img { height: 40px; vertical-align: middle; margin-right: 10px; }
        .match-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            background: #f8fafc;
            padding: 10px;
            border-radius: 8px;
        }

        .timer { font-size: 24px; font-weight: bold; color: var(--danger); text-align: center; }
        .hidden { display: none; }
        
        /* 頁尾 */
        footer { text-align: center; padding: 20px; color: var(--secondary); font-size: 14px; }
        footer a { color: var(--primary); text-decoration: none; }
    </style>
</head>
<body>

<div class="header">
    <h1>著作權合理使用冒險</h1>
    <div id="user-info-bar" class="hidden">
        <span id="display-name">使用者</span> | 分數: <span id="current-score">0</span>
    </div>
</div>

<div class="container">
    <!-- 0. 登入畫面 -->
    <div id="screen-login" class="card">
        <h2 style="text-align: center;">登入挑戰</h2>
        <div style="margin-bottom: 15px;">
            <label>班級</label>
            <select id="input-class">
                <option value="701">701</option><option value="702">702</option><option value="703">703</option>
                <option value="704">704</option><option value="705">705</option>
            </select>
        </div>
        <div style="margin-bottom: 15px;">
            <label>座號</label>
            <input type="number" id="input-seat" placeholder="例如：01">
        </div>
        <div style="margin-bottom: 15px;">
            <label>姓名</label>
            <input type="text" id="input-name" placeholder="請輸入您的姓名">
        </div>
        <button class="btn btn-primary" onclick="startGame()">開始闖關</button>
    </div>

    <!-- 進度條 -->
    <div id="game-progress" class="progress-container hidden">
        <div class="step" id="step-1">L1: 快問快答</div>
        <div class="step" id="step-2">L2: 四大原則</div>
        <div class="step" id="step-3">L3: CC配對</div>
        <div class="step" id="step-4">L4: AI爭議</div>
    </div>

    <!-- Level 1: 是非快問快答 -->
    <div id="level-1" class="card hidden">
        <div class="timer" id="l1-timer">60s</div>
        <h3 id="l1-q-text">題目載入中...</h3>
        <p>題號：<span id="l1-q-index">1</span>/10</p>
        <div style="text-align: center;">
            <button class="btn btn-success tf-btn" onclick="checkL1(true)">O</button>
            <button class="btn btn-danger tf-btn" onclick="checkL1(false)">X</button>
        </div>
        <p id="l1-feedback" style="text-align:center; font-weight:bold;"></p>
    </div>

    <!-- Level 2: 四大原則判斷 -->
    <div id="level-2" class="card hidden">
        <h3>Level 2：合理使用四大原則判斷</h3>
        <p><strong>情境：</strong>老師為了教學需要，影印了某本熱門暢銷小說的「其中一章」給全班同學當作課堂討論素材。</p>
        <p>請點選符合本情境的描述（多選）：</p>
        <div class="principle-box">
            <div class="p-item" onclick="toggleP(this, 1)">① 使用目的：非營利教育目的</div>
            <div class="p-item" onclick="toggleP(this, 2)">② 著作性質：已發表的創作性著作</div>
            <div class="p-item" onclick="toggleP(this, 3)">③ 使用分量：僅佔全書極小部分</div>
            <div class="p-item" onclick="toggleP(this, 4)">④ 市場影響：不影響原書銷售</div>
        </div>
        <button class="btn btn-next" onclick="checkL2()">判定是否合理並進入下一關</button>
    </div>

    <!-- Level 3: CC 授權配對 -->
    <div id="level-3" class="card hidden">
        <h3>Level 3：創用 CC 標誌配對</h3>
        <p>請為下列標誌選擇正確的名稱：</p>
        <div id="cc-match-area">
            <div class="match-row">
                <img src="https://tw.creativecommons.net/wp-content/uploads/sites/20/2020/11/by.png" class="cc-img">
                <select class="cc-sel" data-ans="BY">
                    <option value="">請選擇...</option>
                    <option value="BY">姓名標示</option>
                    <option value="NC">非商業性</option>
                    <option value="ND">禁止改作</option>
                    <option value="SA">相同方式分享</option>
                </select>
            </div>
            <div class="match-row">
                <img src="https://tw.creativecommons.net/wp-content/uploads/sites/20/2020/11/by-nc.png" class="cc-img">
                <select class="cc-sel" data-ans="NC">
                    <option value="">請選擇...</option>
                    <option value="BY">姓名標示</option>
                    <option value="NC">姓名標示-非商業性</option>
                    <option value="ND">禁止改作</option>
                </select>
            </div>
            <div class="match-row">
                <img src="https://tw.creativecommons.net/wp-content/uploads/sites/20/2020/11/by-nd.png" class="cc-img">
                <select class="cc-sel" data-ans="ND">
                    <option value="">請選擇...</option>
                    <option value="ND">姓名標示-禁止改作</option>
                    <option value="SA">相同方式分享</option>
                </select>
            </div>
            <div class="match-row">
                <img src="https://tw.creativecommons.net/wp-content/uploads/sites/20/2020/11/by-sa.png" class="cc-img">
                <select class="cc-sel" data-ans="SA">
                    <option value="">請選擇...</option>
                    <option value="SA">姓名標示-相同方式分享</option>
                    <option value="NC">非商業性</option>
                </select>
            </div>
        </div>
        <button class="btn btn-next" onclick="checkL3()">核對配對</button>
    </div>

    <!-- Level 4: AI 風格爭議 -->
    <div id="level-4" class="card hidden">
        <h3>Level 4：AI 風格爭議模擬</h3>
        <p><strong>案例：</strong>小明使用 AI 繪圖工具，輸入指令「模仿某知名插畫家的風格」生成了一系列圖案，並將這些圖案印成明信片在市集販售。請問這在法律與倫理上如何判斷？</p>
        <div class="options" style="display:flex; flex-direction:column; gap:10px;">
            <button class="btn btn-secondary" onclick="checkL4(1)">✔ 合理：風格不受著作權保護</button>
            <button class="btn btn-secondary" onclick="checkL4(2)">❌ 侵權：完全拷貝了他人的靈魂</button>
            <button class="btn btn-secondary" onclick="checkL4(3)">⚠ 需視情況：雖然風格不保護，但若構圖過於相似仍有風險</button>
        </div>
    </div>

    <!-- 結算畫面 -->
    <div id="screen-result" class="card hidden">
        <h2 style="text-align: center; color: var(--primary);">挑戰完成！</h2>
        <div id="final-score-display" style="font-size: 48px; text-align: center; font-weight: bold;">0</div>
        <p style="text-align: center;" id="sync-status">資料同步中...</p>
        <button class="btn btn-primary" onclick="location.reload()">再挑戰一次</button>
    </div>
</div>

<footer>
    參考資料來源：<a href="https://tw.creativecommons.net/home-page/" target="_blank">台灣創用 CC 資訊網</a>
</footer>

<script>
    // --- 全域變數 ---
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyva0kqJmE1E1BEwwsjARpbbrRzjmdNDEndgqq0jfYXlQc1xz4L6_oj1K3ZsnbQpzd8/exec";
    let score = 0;
    let user = {};
    let l1Index = 0;
    let l1Timer = 60;
    let timerId = null;

    const l1Questions = [
        { q: "著作權是從作品完成的那一刻起就自動產生的。", a: true },
        { q: "只要有註明出處，就可以隨意下載整部電影分送給朋友。", a: false },
        { q: "合理使用必須根據使用目的、著作性質、分量及市場影響來判斷。", a: true },
        { q: "創用CC的「ND」代表禁止改作。", a: true },
        { q: "政府公文與法律條文不受著作權保護。", a: true },
        { q: "只要是為了作業，我可以把整本課本影印下來。", a: false },
        { q: "創用CC中的「SA」代表相同方式分享。", a: true },
        { q: "引用他人文章只要不超過10個字就不算侵權。", a: false },
        { q: "公開播放買來的正版 DVD 給全校看是不需要額外授權的。", a: false },
        { q: "將別人的詩錄音成Podcast並公開播放，需要取得授權。", a: true }
    ];

    // --- 遊戲控制 ---
    function startGame() {
        const cls = document.getElementById('input-class').value;
        const seat = document.getElementById('input-seat').value;
        const name = document.getElementById('input-name').value;

        if(!seat || !name) return alert("請填寫基本資料！");

        user = { cls, seat, name };
        document.getElementById('display-name').innerText = `${cls}班 ${seat}號 ${name}`;
        
        showScreen('level-1');
        document.getElementById('user-info-bar').classList.remove('hidden');
        document.getElementById('game-progress').classList.remove('hidden');
        startL1();
    }

    function showScreen(id) {
        ['screen-login', 'level-1', 'level-2', 'level-3', 'level-4', 'screen-result'].forEach(s => {
            document.getElementById(s).classList.add('hidden');
        });
        document.getElementById(id).classList.remove('hidden');
        
        // 更新進度條
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        if(id.startsWith('level')) {
            const num = id.split('-')[1];
            document.getElementById(`step-${num}`).classList.add('active');
        }
    }

    // --- Level 1 邏輯 ---
    function startL1() {
        l1Index = 0;
        l1Timer = 60;
        updateL1Question();
        timerId = setInterval(() => {
            l1Timer--;
            document.getElementById('l1-timer').innerText = l1Timer + 's';
            if(l1Timer <= 0) {
                clearInterval(timerId);
                alert("時間到！進入下一關");
                showScreen('level-2');
            }
        }, 1000);
    }

    function updateL1Question() {
        if(l1Index >= l1Questions.length) {
            clearInterval(timerId);
            setTimeout(() => showScreen('level-2'), 1000);
            return;
        }
        document.getElementById('l1-q-text').innerText = l1Questions[l1Index].q;
        document.getElementById('l1-q-index').innerText = (l1Index + 1);
    }

    function checkL1(ans) {
        if(ans === l1Questions[l1Index].a) {
            score += 5;
            document.getElementById('l1-feedback').innerHTML = "<span style='color:green'>正確！+5分</span>";
        } else {
            document.getElementById('l1-feedback').innerHTML = "<span style='color:red'>答錯了！</span>";
        }
        document.getElementById('current-score').innerText = score;
        l1Index++;
        setTimeout(() => {
            document.getElementById('l1-feedback').innerText = "";
            updateL1Question();
        }, 500);
    }

    // --- Level 2 邏輯 ---
    let selectedP = [];
    function toggleP(el, num) {
        el.classList.toggle('selected');
        if(el.classList.contains('selected')) selectedP.push(num);
        else selectedP = selectedP.filter(n => n !== num);
    }

    function checkL2() {
        // 這題情境基本上四個原則都要考量，全選或選三個以上視為理解
        if(selectedP.length >= 3) score += 20;
        else score += 10;
        document.getElementById('current-score').innerText = score;
        showScreen('level-3');
    }

    // --- Level 3 邏輯 ---
    function checkL3() {
        let l3Correct = 0;
        document.querySelectorAll('.cc-sel').forEach(sel => {
            if(sel.value === sel.dataset.ans) l3Correct++;
        });
        score += (l3Correct * 5);
        document.getElementById('current-score').innerText = score;
        showScreen('level-4');
    }

    // --- Level 4 邏輯 ---
    function checkL4(choice) {
        // 選 3 是最正確的法律認知 (風險評估)
        if(choice === 3) score += 10;
        else score += 5;
        
        document.getElementById('current-score').innerText = score;
        finishGame();
    }

    // --- 完賽與 GAS 同步 ---
    function finishGame() {
        showScreen('screen-result');
        document.getElementById('final-score-display').innerText = score;
        syncToGAS();
    }

    function syncToGAS() {
        const status = document.getElementById('sync-status');
        status.innerText = "資料上傳同步中...";

        const data = {
            class: user.cls,
            seat: user.seat,
            name: user.name,
            score: score
        };

        // 使用 JSONP 或一般 fetch (視 GAS 設定而定，通常 GAS 需要用 post 或 get)
        // 這裡採用最通用的 GET 傳遞 (注意：GAS 的 doGet 需處理參數)
        const queryParams = new URLSearchParams(data).toString();
        
        fetch(`${GAS_URL}?${queryParams}`, { mode: 'no-cors' })
            .then(() => {
                status.innerText = "✅ 同步成功！老師已收到您的成績。";
            })
            .catch(err => {
                status.innerText = "❌ 同步失敗，請截圖成績畫面給老師。";
                console.error(err);
            });
    }
</script>

</body>
</html>
