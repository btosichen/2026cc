<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è‘—ä½œåˆç†ä½¿ç”¨æŒ‘æˆ°è³½</title>

<script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="min-h-screen bg-gradient-to-br from-cyan-50 via-blue-100 to-purple-100 font-sans text-slate-800">

<div id="app"></div>

<script>

/* =========================
   å…¨åŸŸç‹€æ…‹ç®¡ç†
========================= */
let gameState = "login";
let user = { class: "701", number: "", name: "" };
let score = 0;
let timeElapsed = 0;
let globalTimer = null;

const GAS_URL = "https://script.google.com/macros/s/AKfycbyva0kqJmE1E1BEwwsjARpbbrRzjmdNDEndgqq0jfYXlQc1xz4L6_oj1K3ZsnbQpzd8/exec";
const SHEET_PREVIEW_URL = "https://docs.google.com/spreadsheets/d/1l-9wEmIvy17y7eSRwBloJgAw9JocV74eKiItzcPm9Hw/preview";

const LEVEL1_QUESTIONS = [
"åˆç†ä½¿ç”¨å°±æ˜¯å¯ä»¥éš¨ä¾¿ä½¿ç”¨åˆ¥äººçš„ä½œå“ã€‚",
"æ•™å­¸ç”¨é€”é€šå¸¸æ¯”è¼ƒå®¹æ˜“ç¬¦åˆåˆç†ä½¿ç”¨ã€‚",
"åªè¦æ²’æœ‰æ”¶éŒ¢ï¼Œå°±ä¸€å®šåˆç†ã€‚",
"æ•´æœ¬æ›¸æƒæå‚³çµ¦æœ‹å‹é€šå¸¸ä¸ç®—åˆç†ä½¿ç”¨ã€‚",
"åˆç†ä½¿ç”¨å¿…é ˆè€ƒæ…®å°å¸‚å ´çš„å½±éŸ¿ã€‚",
"ç¶²è·¯ä¸Šçš„åœ–ç‰‡éƒ½å¯ä»¥è‡ªç”±ä½¿ç”¨ã€‚",
"CCæˆæ¬Šä¸€æ—¦å…¬é–‹å°±ä¸èƒ½æ’¤å›ã€‚",
"CC0ä½œå“å¯ä»¥å•†æ¥­ä½¿ç”¨ã€‚",
"å¼•ç”¨å…¨éƒ¨å…§å®¹é€šå¸¸ç¬¦åˆåˆç†ä½¿ç”¨ã€‚",
"æ¨¡ä»¿å‹•ç•«é¢¨æ ¼å¯èƒ½æœƒæœ‰è‘—ä½œæ¬Šçˆ­è­°ã€‚"
];

/* =========================
   åŸºæœ¬å·¥å…·
========================= */

function render(html){
  document.getElementById("app").innerHTML = html;
}

function startTimer(){
  globalTimer = setInterval(()=>{
    timeElapsed++;
    const t = document.getElementById("globalTime");
    if(t) t.innerText = timeElapsed + " ç§’";
  },1000);
}

function stopTimer(){
  clearInterval(globalTimer);
}

/* =========================
   Header
========================= */

function header(title){
return `
<div class="flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-md">
  <div class="text-blue-600 font-extrabold text-xl">${title}</div>
  <div class="flex gap-6 font-bold">
    <div>â± <span id="globalTime">${timeElapsed} ç§’</span></div>
    <div>ğŸ† ${score} åˆ†</div>
  </div>
</div>
`;
}

/* =========================
   Login
========================= */

function showLogin(){
render(`
<div class="flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center">
    <h1 class="text-3xl font-black mb-6 text-orange-500">è‘—ä½œåˆç†ä½¿ç”¨æŒ‘æˆ°è³½</h1>
    <div class="space-y-4">
      <select id="classSelect" class="w-full p-3 border rounded-xl">
        ${[...Array(10)].map((_,i)=>`<option value="70${i+1}">70${i+1}</option>`).join("")}
      </select>
      <input id="numberInput" type="number" placeholder="åº§è™Ÿ" class="w-full p-3 border rounded-xl">
      <input id="nameInput" type="text" placeholder="å§“å" class="w-full p-3 border rounded-xl">
      <button onclick="login()" class="w-full bg-orange-500 text-white p-3 rounded-xl font-bold">é–‹å§‹æŒ‘æˆ°</button>
      <button onclick="showRecords()" class="w-full bg-blue-500 text-white p-3 rounded-xl font-bold">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
    </div>
  </div>
</div>
`);
}

function login(){
user.class = document.getElementById("classSelect").value;
user.number = document.getElementById("numberInput").value;
user.name = document.getElementById("nameInput").value;

if(!user.number || !user.name){
  alert("è«‹è¼¸å…¥åº§è™Ÿèˆ‡å§“å");
  return;
}

score = 0;
timeElapsed = 0;
gameState = "intro";
showIntro();
}

/* =========================
   Intro
========================= */

function showIntro(){
render(`
<div class="p-8">
${header("ä»»å‹™èªªæ˜")}
<div class="bg-white p-6 rounded-2xl shadow">
  <p class="mb-6">è«‹å…ˆè§€çœ‹å½±ç‰‡ï¼Œå†é€²å…¥é—œå¡</p>
  <div class="aspect-video mb-6">
    <iframe class="w-full h-full" src="https://www.youtube.com/embed/9fuajCuCV4g"></iframe>
  </div>
  <button onclick="startGame()" class="w-full bg-blue-500 text-white p-4 rounded-xl font-bold">é€²å…¥ Level 1</button>
</div>
</div>
`);
}

function startGame(){
startTimer();
showLevel1();
}

/* =========================
   Level 1
========================= */

let qIndex = 0;

function showLevel1(){
render(`
<div class="p-8">
${header("Level 1 å¿«å•å¿«ç­”")}
<div class="bg-white p-6 rounded-2xl text-center shadow">
  <div class="mb-6 text-xl font-bold">${LEVEL1_QUESTIONS[qIndex]}</div>
  <div class="flex justify-center gap-6">
    <button onclick="answer(true)" class="bg-blue-500 text-white px-8 py-4 rounded-xl text-2xl">O</button>
    <button onclick="answer(false)" class="bg-red-500 text-white px-8 py-4 rounded-xl text-2xl">X</button>
  </div>
</div>
</div>
`);
}

function answer(ans){
const _m = 365;
const _e = ((_m >> (9 - qIndex)) & 1) === 1;

if(ans === _e){
  score += 5;
}

qIndex++;

if(qIndex < LEVEL1_QUESTIONS.length){
  showLevel1();
}else{
  showLevel2();
}
}

/* =========================
   Level 2
========================= */

function showLevel2(){
render(`
<div class="p-8">
${header("Level 2 å››å¤§åŸå‰‡")}
<div class="bg-white p-6 rounded-2xl shadow text-center">
  <p class="mb-6">å°æ˜åšå ±å‘Šæˆªåœ–ä¸€å°éƒ¨åˆ†ä¸¦æ¨™ç¤ºä½œè€…</p>
  <button onclick="score+=20;showLevel3();" class="bg-green-500 text-white px-8 py-4 rounded-xl font-bold">åˆ¤å®šåˆç†ä½¿ç”¨</button>
</div>
</div>
`);
}

/* =========================
   Level 3
========================= */

function showLevel3(){
render(`
<div class="p-8">
${header("Level 3 CCæˆæ¬Š")}
<div class="bg-white p-6 rounded-2xl shadow text-center">
  <p class="mb-6">CC0 å¯ä»¥å•†æ¥­ä½¿ç”¨ï¼Ÿ</p>
  <button onclick="score+=20;showLevel4();" class="bg-blue-500 text-white px-8 py-4 rounded-xl">æ­£ç¢º</button>
</div>
</div>
`);
}

/* =========================
   Level 4
========================= */

function showLevel4(){
render(`
<div class="p-8">
${header("Level 4 AIçˆ­è­°")}
<div class="bg-white p-6 rounded-2xl shadow text-center">
  <p class="mb-6">AI æ¨¡ä»¿å‰åœåŠ›é¢¨æ ¼è²©å”®å•†å“æ˜¯å¦æœ‰é¢¨éšªï¼Ÿ</p>
  <button onclick="score+=20;showCourt();" class="bg-red-500 text-white px-8 py-4 rounded-xl">æœ‰é¢¨éšª</button>
</div>
</div>
`);
}

/* =========================
   Court
========================= */

function showCourt(){
render(`
<div class="p-8">
${header("æœ€çµ‚æ³•åº­")}
<div class="bg-white p-6 rounded-2xl shadow text-center">
  <p class="mb-6">ç¶²ç´…å‰ªè¼¯ç›œç‰ˆé›»å½±ç²¾è¯ç›ˆåˆ©æ˜¯å¦åˆç†ï¼Ÿ</p>
  <button onclick="score+=20;finishGame();" class="bg-orange-500 text-white px-8 py-4 rounded-xl">ä¸åˆç†</button>
</div>
</div>
`);
}

/* =========================
   Result + GAS
========================= */

function finishGame(){
stopTimer();

render(`
<div class="flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center">
    <h2 class="text-2xl font-black mb-4">æŒ‘æˆ°å®Œæˆï¼</h2>
    <p class="mb-4">${user.class} ${user.number} ${user.name}</p>
    <p class="text-3xl font-bold mb-4">${score} åˆ†</p>
    <p>${timeElapsed} ç§’</p>
    <button onclick="uploadScore()" class="mt-6 bg-blue-500 text-white p-3 rounded-xl w-full">ä¸Šå‚³æˆç¸¾</button>
    <button onclick="location.reload()" class="mt-2 bg-gray-300 p-3 rounded-xl w-full">é‡æ–°æŒ‘æˆ°</button>
  </div>
</div>
`);
}

async function uploadScore(){
const formData = new URLSearchParams();
formData.append('class', user.class);
formData.append('number', user.number);
formData.append('name', user.name);
formData.append('score', score);
formData.append('time', timeElapsed);

await fetch(GAS_URL,{
method:'POST',
mode:'no-cors',
headers:{'Content-Type':'application/x-www-form-urlencoded'},
body:formData.toString()
});

alert("æˆç¸¾å·²é€å‡ºï¼");
}

/* =========================
   Records
========================= */

function showRecords(){
render(`
<div class="p-8">
${header("æ’è¡Œæ¦œ")}
<div class="bg-white p-6 rounded-2xl shadow">
<iframe src="${SHEET_PREVIEW_URL}" class="w-full h-[600px]"></iframe>
<button onclick="showLogin()" class="mt-4 bg-blue-500 text-white p-3 rounded-xl w-full">è¿”å›é¦–é </button>
</div>
</div>
`);
}

/* =========================
   åˆå§‹åŒ–
========================= */

showLogin();

</script>
</body>
</html>
